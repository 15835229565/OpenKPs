KpMQTT
=============================

Драйвер KpMQTT.dll является прикладной библиотекой для приложения Scada Communicator проекта RapidScada.
При помощи данного драйвера можно осуществлять прием и передащу сообщений по протоклу MQTT.

Краткое введение в протокол MQTT.
------------------------------------

MQTT - является простым сетевым протоколом, который получил наибольшую популярность в сетях IoT, для обмена информацией между различными устройствами. На текущий момент протокол реализован на достаточно большом количестве языков программирования, в том числе и на C#. Это позволяет реализовать телематику между разнородными системами в виде универсальной шины передачи данных.
Спецификация протокола находится по [ссылке](http://mqtt.org "ссылка на спецификацию протокола MQTT") .

Программная модель взаимодействия по протоколу MQTT выстраиваивается по клиент-серверной архитектуре. В качестве сервера обычно выступает так называемый брокер запросов. В качестве клиента может выступать любое приложение, которое реализует протокол MQTT. Взаимодействие между клиентом и брокером осуществляется по модели публикатор-подписчик. Данная модель позволяет организовать оптимальный механизм пердачи данных между клиентом и брокером. Клиент подписывается на необходимое ему количество сообщений. Брокер регистрирует запрашиваемую пользователем подписку в виде имени идентификатора сообщения. Такое имя выстраивается по определенным правилам, описанным в спецификации. При поступлении новых сообщений брокер осуществляет оповещение всех клиентов которые подписаны на соответствующий идентификатор. В обычном сленге наименование идентфикатора сообщения называется топиком (TopicName). Также клиент может публиковать сообщения. Соответственно при публикации сообщения клиент указывает имя топика, для которого предназначены передаваемые данные. Брокер получив такое сообщение оповещает всех клиентов, подписавшихся на данное имя топика.

Примеры построения топиков.
------------------------------

Обычно описание большинства структурированных объектов можно представить в виде древовидной структуры. Так к примеру описание доступа к каналам RapidScada можно было бы представить в виде следуещей иерархии:

\/rapidobject/rapidkp/rapidcnl , где

- rapidobject может выступать в виде уникальноко номера объекта из справочника объектов;
- rapidkp может выступать в виде уникального номера КП;
- rapidcnl может выступать в виде номера канала;

В итоге имя топика может получиться таким: \/1/1/1 (номер объекта/номер КП/номер канала) или таким \/1/1/2. Что в целом будет описывать объект №1, который включает в себя КП 1, у которого в свою очередь есть канал №1 и №2.

Именование топиков может быть более определенным при использовании собственных правил кодирования принятых для объекта автоматизации. Но следует учитывать, что общая длинна топика ограничивается стандартом.

Брокеры MQTT.
----------------------------

На [сранице описания протокола MQTTT](http://mqtt.org) находится информация по различным реализациям клиентских и серверных приложений. Чаще всего в качестве брокера MQTT для IoT проектов используют сервер [Mosquitto](http://mosquitto.org) . На сайте проекта присутствует достаточный объем документации, который позволит развернуть сервер для различных операционных систем, включая операционную систему Windows. Проект [Mosquitto](http://mosquitto.org) активно поддерживается и соотвествует последним версиям спецификации протокола MQTT. Программные пакеты данного брокера доступны также для роутеров на базе ОС OpenWRT.
Также есть открытые проекты для установки брокеров масштаба предприятия, которые позволяют выдерживать высокие нагрузки и обеспечивать механизмы отказоустойчивости.



Для настройки линии связи используется конфигурационный файл содержание которого приведено ниже.

```xml
<?xml version="1.0" encoding="utf-8"?>
<DevTemplate>
  <MqttParams Hostname="iot.eclipse.org" ClientID="KpMQTTmes" Port="1883" UserName="" Password=""/>
  <RapSrvCnf ServerHost="xxx.xxx.xxx.xxx" ServerPort="10000" ServerUser="ScadaComm" ServerPwd="12345"/>
  <MqttSubTopics>
  	<Topic TopicName="/myparam1" QosLevel="0" NumCnl="271"/>
  	<Topic TopicName="/myparam2" QosLevel="0" NumCnl="272"/>
  </MqttSubTopics>
  <MqttPubTopics>
	<Topic TopicName="/myparam10" QosLevel="0" NumCnl="21"/>
  </MqttPubTopics>
</DevTemplate>
```
